String.prototype.En3DexCode=function(){var t=this.valueOf();return App.encryptWith3DES(t)||t},String.prototype.De3DexCode=function(){var t=this.valueOf();return App.decryptBy3DES(t)||t},function(t,e){function r(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function n(){return r()+r()+"-"+r()+"-"+r()+"-"+r()+"-"+r()+r()+r()}e.LocalStorage=window.Store=function(t){this.NS(t)},t.extend(e.LocalStorage.prototype,{NS:function(t){this.name=t,this.repairStorage(t);var e=this.localStorage().getItem(this.name);return this.records=e&&e.split(",")||[],this},save:function(){return this.localStorage().setItem(this.name,this.records.join(",")),this},create:function(t){return t.id||(t.id=n(),t.set(t.idAttribute,t.id)),this.update(t)},update:function(e){return this.localStorage().setItem(this.name+"-"+e.id,JSON.stringify(e).En3DexCode()),t.contains(this.records,e.id.toString())||this.records.push(e.id.toString()),this.save(),e.toJSON()},find:function(r){this.NS(this.name);var n=r instanceof e.Model?r.id:String(r),o=this.localStorage().getItem(this.name+"-"+n);if(t.isEmpty(o))return this.destroy(r),null;try{try{o=JSON.parse(o.De3DexCode())}catch(t){if(!(t instanceof SyntaxError))throw t;o=JSON.parse(o)}}catch(t){return null}return o},findAll:function(e){this.NS(this.name);var r=[],e=e||{};return r=e.ids||this.records,"undefined"!=typeof e.offset&&e.offset>=0&&(r=r.slice(e.offset,e.offset+e.limit||15)),t(r).chain().map(function(t){return this.find(t)},this).compact().value()},destroy:function(r){var n=r instanceof e.Model?r.id:String(r);return this.localStorage().removeItem(this.name+"-"+n),this.records=t.reject(this.records,function(t){return t==n.toString()}),this.save(),r},localStorage:function(){return localStorage},total:function(){return this.records.length},repairStorage:function(t){if(t){var e="",r=0;for(var n in window.localStorage)n.indexOf(t)!=-1&&(e+=0!=r?","+n.substr(t.length+1):n.substr(t.length+1),r++);window.localStorage.setItem(t,e)}}}),e.LocalStorage.sync=window.Store.sync=e.localSync=function(t,e,r){var n,o=e.localStorage||e.collection.localStorage,i=$.Deferred&&$.Deferred();switch(t){case"read":n=void 0!=e.id?o.find(e):o.findAll(r);break;case"create":n=o.create(e);break;case"update":n=o.update(e);break;case"delete":n=o.destroy(e)}return n?(r&&r.success&&r.success(n),i&&i.resolve()):(r&&r.error&&r.error("数据无法创建"),i&&i.reject()),i&&i.promise()},e.ajaxSync=e.sync,e.getSyncMethod=function(t){return t.localStorage||t.collection&&t.collection.localStorage?e.localSync:e.ajaxSync},e.sync=function(t,r,n){return e.getSyncMethod(r).apply(this,[t,r,n])}}(_,Backbone);
//# sourceMappingURL=backbone.localStorage.js.map
