!function(){"use strict";function e(t,r){return function(n){var o=n.name;if("undefined"==typeof o)throw"'name' property is mandatory ";n=_.extend({},r,n);var i=_.extend({},a.Controller),c={},u={};_.each(n,function(e,t){if(i[t]=e,"function"!=typeof e||"_"===t[0]||_.indexOf(f,t)>=0)return!1;if(c[t]=e,t.match(/^user_/i)){u[t]=e;var r=t.replace(/^user_/i,"");"function"!=typeof n[r]&&(u[r]=e,c[r]=e)}}),_.extend(i,c,{_actions:c,_secureActions:u}),"extend"in i&&delete i.extend;var p=s.extend(i);return _.extend(p,{extend:e(p,_.extend({},r,n))}),p.prototype.constructor.__super__=t.prototype,l[o]=p,p}}function t(e){return _.isObject(e)&&e.promise&&"function"==typeof e.promise}function r(e,t){return"undefined"==typeof t&&(t=!0),e[t?"resolve":"reject"](t)}function n(e){return"string"!=typeof e?null:(e=e.replace(/\s{2,}/g," "),_.map(e.split(" "),function(e){return e.replace(/(^|_)[a-z]/gi,function(e){return e.toUpperCase()}).replace(/_/g,"")}).join(" "))}function o(e){return"string"!=typeof e?null:(e=e.replace(/\s{2,}/g," "),_.map(e.split(" "),function(e){return e.replace(/^[A-Z]/g,function(e){return e.toLowerCase()}).replace(/([a-z])([A-Z])/g,function(e,t,r){return t+"_"+r.toLowerCase()})}).join(" "))}function i(e,n,o){var i=new l[e],c=[n].concat(o),u=$.Deferred(),a=i.beforeFilter.apply(i,c);return t(a)?u=a:r(u,a),"function"==typeof i._secureActions[n]&&(u=u.pipe(function(){var e=i.checkSession.apply(i,o);return t(e)?e:r($.Deferred(),e)})),u=u.pipe(function(){var e=i[n].apply(i,o);return t(e)?e:r($.Deferred(),e)}),u=u.pipe(function(){var e=i.afterRender.apply(i,c);return t(e)?e:r($.Deferred(),e)})}function c(e,t,r,n){e._history.length>888&&(e._history=_.last(e._history,888)),e._history.push([t,r,n])}var u="BackboneMVC";if("undefined"!=typeof Backbone&&"undefined"!=typeof _){var a=window[u]={},s=function(){function e(){this._created=(new Date).getTime()}return _.extend(e.prototype,{_created:null}),e.extend=function(t){var r,n=function(){return void 0!==r?r:(e.apply(this,arguments),void 0!==this.initialize&&this.initialize.apply(this,arguments),r=this)};return n.prototype=new e,_.extend(n.prototype,t),n.prototype.constructor=n,n.prototype.classId=_.uniqueId("controller_"),n},e}();_.extend(a,{namespace:function(e){for(var t=e.split("."),r=window,n=0,o=t.length;n<o;n++)void 0===r[t[n]]&&(r[t[n]]={}),r=r[t[n]]},Controller:{beforeFilter:function(){return $.Deferred().resolve()},afterRender:function(){return $.Deferred().resolve()},checkSession:function(){return $.Deferred().resolve(!0)},default:function(){return!0}},Router:function(){function e(e){var r=_.extend(e.routes||{},t.routes);return Backbone.Router.extend(_.extend(e,t,{routes:r}))}var t={_history:[],ControllersPool:{},routes:{"*components":"dispatch"},dispatch:function(e){var t,r=e.replace(/\/+$/g,"").split("/");l[r[0]]?t=r[0]:"undefined"!=typeof l[n(r[0])]?t=n(r[0]):"undefined"!=typeof l[o(r[0])]&&(t=o(r[0]));var u=r.length>1?r[1]:"default",a=r.length>2?_.rest(r,2):[];if("undefined"==typeof t)return this[404]&&this[404](r[0],u,a);var s=new l[t];return"function"!=typeof s._actions[u]?this[404]&&this[404](t,u,a):(s.router=this,this.ControllersPool[t]=s,Backbone.View.prototype.Controller=s,Backbone.Model.prototype.Controller=s,c(this,t,u,a),i(t,u,a))},getLastAction:function(){return _.last(this._history,1)[0]||[]},navigate:function(e,t){t&&t!==!0||(t={trigger:t});var r=_.extend({},t);return r.trigger=!1,Backbone.Router.prototype.navigate.call(this,e,r),t.trigger?this.dispatch(e):$.Deferred().resolve()}},r=Backbone.Router.extend(_.extend({extend:e},t));return r.extend=e,r}(),Model:{extend:function(e){return e=_.extend({__fetchSuccessCallback:null,__fetchErrorCallback:null,fetch:function(e){e=e||{};var t=e.success;e.success=function(e,r){if(t&&t(e,r),e.__fetchSuccessCallback){var n=e.__fetchSuccessCallback;e.__fetchSuccessCallback=null,n.apply(e)}};var r=e.error;e.error=function(e,t){r&&r(e,t),e.trigger("error",r)},Backbone.Model.prototype.fetch.apply(this,[e].concat(_.rest(arguments)))},parse:function(e){return this.__fetchSuccessCallback=null,this.__fetchErrorCallback=null,!e||e.error?(this.trigger("error",e&&e.error||e),{}):(this.__fetchSuccessCallback=function(){this.trigger("read",e.data)}.bind(this),e.data)}},e),Backbone.Model.extend(e)}}}),a.Controller.extend=e(a.Controller,{});var l={},f=["initialize","beforeFilter","afterRender","checkSession"]}}();
//# sourceMappingURL=backbone.controller-1.0.js.map
