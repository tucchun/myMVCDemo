{"version":3,"sources":["assets/lib/PAWA/PAWAController.js"],"names":["define","PAWA","Backbone","PAWAController","options","this","initialize","apply","arguments","_","extend","prototype","Events","actions","router","list","route","prefix","module","name","key","unshift","i","len","length","bind","__recordLog__","init","destroy","handlers","history","handler","exp","_routeToRegExp","toString","splice","protoProps","classProps","Controller","PAWAModel","call","getInstance","_instance"],"mappings":"AAGAA,QAAQ,OAAQ,YAAa,SAASC,EAAMC,GACxC,GAAIC,GAAiBF,EAAKE,eAAiB,SAASC,GAChDC,KAAKC,WAAWC,MAAMF,KAAMG,WA8DhC,OA3DAC,GAAEC,OAAOP,EAAeQ,UAAWT,EAASU,QACxCN,WAAa,SAASF,GAClB,GAAIS,GAAUR,KAAKQ,OACnB,IAAGA,EAAS,CACR,GAAIC,GAASb,EAAKa,OAAQC,KAAWC,EAAQ,KAAMC,EAASZ,KAAKa,OAAS,IAAMb,KAAKc,IACrF,KAAI,GAAIC,KAAOP,GACXE,EAAKM,SAASD,EAAKf,KAAKQ,EAAQO,KAGpC,KAAI,GAAIE,GAAI,EAAGC,EAAMR,EAAKS,OAAQF,EAAIC,EAAKD,IACvCN,EAAQD,EAAKO,GACbR,EAAOE,MAAMC,GAAuB,KAAbD,EAAM,GAAY,GAAK,IAAMA,EAAM,IAAK,GAAIP,EAAEgB,KAAKT,EAAM,GAAIX,OAGrGA,KAAKqB,gBACIrB,KAAKsB,KAAKpB,MAAMF,KAAMG,YAG1BU,OAAS,GAETC,KAAO,GAEPN,QAAU,KAEVc,KAAO,SAASvB,KAGhBwB,QAAU,WACN,GAAIf,GAAUR,KAAKQ,OACnB,IAAGA,EAAS,CACR,GAAIC,GAASb,EAAKa,OAAQe,EAAW5B,EAAK6B,QAAQD,SAAUE,EAAU,KAAMd,EAASZ,KAAKa,OAAS,IAAMb,KAAKc,KAAO,GACrH,KAAI,GAAIC,KAAOP,GAGX,IAAI,GAFAmB,GAAMlB,EAAOmB,eAAehB,EAASG,GAAKc,WAEtCZ,EAAI,EAAGC,EAAMM,EAASL,OAAQF,EAAIC,EAAKD,IAE3C,GADAS,EAAUF,EAASP,GAChBS,EAAQf,MAAMkB,YAAcF,EAAK,CAChCH,EAASM,OAAOb,EAAG,EACnB,YASxBnB,EAAeO,OAAS,SAAS0B,EAAYC,GACzC,GAAIC,GAAarC,EAAKsC,UAAU7B,OAAO8B,KAAKnC,KAAM+B,EAAYC,EAS9D,OAPAC,GAAWG,YAAc,SAASrC,GAK9B,MAJIC,MAAKqC,YACLrC,KAAKqC,UAAY,GAAIrC,MAAKD,IAGvBC,KAAKqC,WAETJ,GAEJnC","file":"PAWAController.js","sourcesContent":["/**\r\n * 创建Controller控制器, 控制器作为执行业务逻辑的容器, 并负责创建调度模型和视图\r\n */\r\ndefine(['PAWA', 'backbone'], function(PAWA, Backbone) {\r\n    var PAWAController = PAWA.PAWAController = function(options) {\r\n        this.initialize.apply(this, arguments);\r\n    }\r\n    // Controller继承Backbone.Events, 因此允许使用Events中的事件方法\r\n    _.extend(PAWAController.prototype, Backbone.Events, {\r\n        initialize : function(options) {\r\n            var actions = this.actions;\r\n            if(actions) {\r\n                var router = PAWA.router, list = [], route = null, prefix = this.module + '/' + this.name;\r\n                for(var key in actions) {\r\n                    list.unshift([key, this[actions[key]]]);\r\n                }\r\n\r\n                for(var i = 0, len = list.length; i < len; i++) {\r\n                    route = list[i];\r\n                    router.route(prefix + (route[0] === '' ? '' : \"/\" + route[0]), '', _.bind(route[1], this));\r\n                }\r\n            }\r\n\t\t\tthis.__recordLog__();\r\n            this.init.apply(this, arguments);\r\n        },\r\n        // 模块名\r\n        module : '',\r\n        // 控制器名, 用于模块路由时定义规则\r\n        name : '',\r\n        // 模块规则\r\n        actions : null,\r\n        // 初始化方法\r\n        init : function(options) {\r\n        },\r\n        // 在销毁控制器时同时移除URL中的Action监听\r\n        destroy : function() {\r\n            var actions = this.actions;\r\n            if(actions) {\r\n                var router = PAWA.router, handlers = PAWA.history.handlers, handler = null, prefix = this.module + '/' + this.name + '/';\r\n                for(var key in actions) {\r\n                    var exp = router._routeToRegExp(prefix + key).toString();\r\n\r\n                    for(var i = 0, len = handlers.length; i < len; i++) {\r\n                        handler = handlers[i];\r\n                        if(handler.route.toString() == exp) {\r\n                            handlers.splice(i, 1);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    // 添加控制器的继承方法, 在继承子控制器时自动添加getInstance获取单例的方法\r\n    PAWAController.extend = function(protoProps, classProps) {\r\n        var Controller = PAWA.PAWAModel.extend.call(this, protoProps, classProps);\r\n\r\n        Controller.getInstance = function(options) {\r\n            if(!this._instance) {\r\n                this._instance = new this(options);\r\n            }\r\n\r\n            return this._instance;\r\n        }\r\n        return Controller;\r\n    }\r\n    return PAWAController;\r\n});\r\n"]}